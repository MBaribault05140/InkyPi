<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  integrity="sha384-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
  crossorigin="" />
<script
  src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
  integrity="sha384-hB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
  crossorigin="">
</script>

<!-- === Location Picker === -->
<div class="form-group">
  <label class="form-label">Location:</label>
  <div class="form-group">
    <span>Latitude </span>
    <input readonly type="text" id="latitude" name="latitude" class="form-input" />
  </div>
  <div class="form-group">
    <span>Longitude </span>
    <input readonly type="text" id="longitude" name="longitude" class="form-input" />
  </div>
  <button type="button" id="openMap" class="action-button compact">
    Select Location
  </button>
</div>

<!-- === Manual Display Name === -->
<div class="form-group">
  <label for="manual_location_name" class="form-label">Display Location Name</label>
  <input
    type="text"
    id="manual_location_name"
    name="manual_location_name"
    class="form-input"
    placeholder="e.g., Home, Office, My Town"
    value="">
  <small class="form-text text-muted">
    Whatever you enter here will override the location shown on the e-ink display.
  </small>
</div>

<!-- === Toggle What to Show === -->
<div class="form-group">
  <label class="form-label">Display:</label>
  <div class="form-group">
    <input
      type="checkbox"
      id="displayMetrics"
      name="displayMetrics"
      onclick="this.value=this.checked ? 'true':'false';">
    <span>Metrics</span>
  </div>
  <div class="form-group">
    <input
      type="checkbox"
      id="displayGraph"
      name="displayGraph"
      onclick="this.value=this.checked ? 'true':'false';">
    <span>Graph</span>
  </div>
  <div class="form-group">
    <input
      type="checkbox"
      id="displayForecast"
      name="displayForecast"
      onclick="this.value=this.checked ? 'true':'false';">
    <span>Forecast</span>
  </div>
</div>

<!-- === Forecast Days === -->
<div class="form-group">
  <label for="forecastDays" class="form-label">Forecast Days:</label>
  <input
    type="number"
    id="forecastDays"
    name="forecastDays"
    class="form-input"
    min="0"
    max="7">
</div>

<button id="saveSettings" class="action-button">Save</button>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // — Your existing map/modal init code goes here —

    // Populate fields from saved settings:
    if (typeof pluginSettings !== 'undefined') {
      document.getElementById('latitude').value  = pluginSettings.latitude;
      document.getElementById('longitude').value = pluginSettings.longitude;
      document.getElementById('displayMetrics').checked  = pluginSettings.displayMetrics;
      document.getElementById('displayMetrics').value    = pluginSettings.displayMetrics;
      document.getElementById('displayGraph').checked    = pluginSettings.displayGraph;
      document.getElementById('displayGraph').value      = pluginSettings.displayGraph;
      document.getElementById('displayForecast').checked = pluginSettings.displayForecast;
      document.getElementById('displayForecast').value   = pluginSettings.displayForecast;
      document.getElementById('forecastDays').value      = pluginSettings.forecastDays;
      document.getElementById('manual_location_name').value = pluginSettings.manual_location_name || '';
    }
  });

  document.getElementById('saveSettings').addEventListener('click', () => {
    const settings = {
      latitude: document.getElementById('latitude').value,
      longitude: document.getElementById('longitude').value,
      displayMetrics: document.getElementById('displayMetrics').checked,
      displayGraph: document.getElementById('displayGraph').checked,
      displayForecast: document.getElementById('displayForecast').checked,
      forecastDays: parseInt(document.getElementById('forecastDays').value, 10),
      manual_location_name: document.getElementById('manual_location_name').value.trim()
    };
    savePluginSettings(settings);
  });
</script>
